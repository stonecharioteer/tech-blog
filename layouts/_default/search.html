{{- define "main" }}
<div class="search-container">
    <h1>{{ .Title }}</h1>
    
    <div class="search-box">
        <input type="search" id="searchBox" placeholder="Search posts..." />
        <button type="button" id="searchButton">Search</button>
    </div>
    
    <div id="searchResults" class="search-results"></div>
    
    <script src="https://unpkg.com/fuse.js@6.6.2/dist/fuse.min.js"></script>
    <script>
        const searchBox = document.getElementById('searchBox');
        const searchButton = document.getElementById('searchButton');
        const searchResults = document.getElementById('searchResults');
        let fuse;
        
        // Load search index
        fetch('/index.json')
            .then(response => response.json())
            .then(data => {
                const fuseOptions = {
                    isCaseSensitive: {{ .Site.Params.fuseOpts.isCaseSensitive | default false }},
                    shouldSort: {{ .Site.Params.fuseOpts.shouldSort | default true }},
                    location: {{ .Site.Params.fuseOpts.location | default 0 }},
                    distance: {{ .Site.Params.fuseOpts.distance | default 1000 }},
                    threshold: {{ .Site.Params.fuseOpts.threshold | default 0.4 }},
                    minMatchCharLength: {{ .Site.Params.fuseOpts.minMatchCharLength | default 0 }},
                    keys: {{ .Site.Params.fuseOpts.keys | default (slice "title" "content") }}
                };
                fuse = new Fuse(data, fuseOptions);
            });
        
        function performSearch() {
            const query = searchBox.value.trim();
            if (!query || !fuse) {
                searchResults.innerHTML = '';
                return;
            }
            
            const results = fuse.search(query);
            displayResults(results);
        }
        
        function displayResults(results) {
            if (results.length === 0) {
                searchResults.innerHTML = '<p>No results found.</p>';
                return;
            }
            
            const html = results.map(result => {
                const item = result.item;
                return `
                    <div class="search-result">
                        <h3><a href="${item.permalink}">${item.title}</a></h3>
                        <p class="search-summary">${item.summary || ''}</p>
                        <div class="search-meta">
                            ${item.date ? `<time>${new Date(item.date).toLocaleDateString()}</time>` : ''}
                            ${item.tags ? item.tags.map(tag => `<span class="tag">${tag}</span>`).join('') : ''}
                        </div>
                    </div>
                `;
            }).join('');
            
            searchResults.innerHTML = html;
        }
        
        searchBox.addEventListener('input', performSearch);
        searchButton.addEventListener('click', performSearch);
        searchBox.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                performSearch();
            }
        });
    </script>
</div>

<style>
.search-container {
    max-width: 800px;
    margin: 0 auto;
}

.search-box {
    display: flex;
    gap: 0.5rem;
    margin: 2rem 0;
}

.search-box input {
    flex: 1;
    padding: 0.75rem;
    border: 1px solid var(--border);
    border-radius: 0.25rem;
    background: var(--entry);
    color: var(--primary);
    font-size: 1rem;
}

.search-box button {
    padding: 0.75rem 1.5rem;
    background: var(--theme);
    color: var(--entry);
    border: none;
    border-radius: 0.25rem;
    cursor: pointer;
    font-size: 1rem;
}

.search-box button:hover {
    opacity: 0.8;
}

.search-results {
    margin-top: 2rem;
}

.search-result {
    padding: 1.5rem 0;
    border-bottom: 1px solid var(--border);
}

.search-result:last-child {
    border-bottom: none;
}

.search-result h3 {
    margin: 0 0 0.5rem 0;
}

.search-result h3 a {
    color: var(--primary);
    text-decoration: none;
}

.search-result h3 a:hover {
    color: var(--theme);
}

.search-summary {
    color: var(--secondary);
    margin: 0.5rem 0;
    line-height: 1.6;
}

.search-meta {
    display: flex;
    gap: 1rem;
    align-items: center;
    font-size: 0.875rem;
    color: var(--secondary);
}

.search-meta time {
    font-family: var(--code-font-family);
}

.search-meta .tag {
    background: var(--code-bg);
    padding: 0.125rem 0.375rem;
    border-radius: 0.25rem;
    font-size: 0.75rem;
    margin-right: 0.25rem;
}
</style>
{{- end }}